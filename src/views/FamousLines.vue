<script setup lang="ts">
import { ref, computed } from 'vue';
import { useRouter } from 'vue-router';
import SearchBar from '../components/SearchBar.vue';
import type { Poetry } from '../types/poetry';

interface FamousLine {
  id: string;
  content: string;
  poetryTitle: string;
  author: string;
  dynasty: string;
  theme: string;
  poetryId: string;
}

const router = useRouter();
const selectedTheme = ref('');
const searchQuery = ref('');

const famousLines: FamousLine[] = [
  {
    id: '1',
    content: 'æµ·å†…å­˜çŸ¥å·±ï¼Œå¤©æ¶¯è‹¥æ¯”é‚»',
    poetryTitle: 'é€æœå°‘åºœä¹‹ä»»èœ€å·',
    author: 'ç‹å‹ƒ',
    dynasty: 'å”',
    theme: 'å‹æƒ…',
    poetryId: '29'
  },
  {
    id: '2',
    content: 'æ¬²ç©·åƒé‡Œç›®ï¼Œæ›´ä¸Šä¸€å±‚æ¥¼',
    poetryTitle: 'ç™»é¹³é›€æ¥¼',
    author: 'ç‹ä¹‹æ¶£',
    dynasty: 'å”',
    theme: 'å“²ç†',
    poetryId: '3'
  },
  {
    id: '3',
    content: 'æµ·å†…å­˜çŸ¥å·±ï¼Œå¤©æ¶¯è‹¥æ¯”é‚»',
    poetryTitle: 'é€æœå°‘åºœä¹‹ä»»èœ€å·',
    author: 'ç‹å‹ƒ',
    dynasty: 'å”',
    theme: 'é€åˆ«',
    poetryId: '29'
  },
  {
    id: '4',
    content: 'æ˜¥çœ ä¸è§‰æ™“ï¼Œå¤„å¤„é—»å•¼é¸Ÿ',
    poetryTitle: 'æ˜¥æ™“',
    author: 'å­Ÿæµ©ç„¶',
    dynasty: 'å”',
    theme: 'æ˜¥å¤©',
    poetryId: '2'
  },
  {
    id: '5',
    content: 'åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœ',
    poetryTitle: 'é™å¤œæ€',
    author: 'æç™½',
    dynasty: 'å”',
    theme: 'æ€ä¹¡',
    poetryId: '1'
  },
  {
    id: '6',
    content: 'ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡',
    poetryTitle: 'é™å¤œæ€',
    author: 'æç™½',
    dynasty: 'å”',
    theme: 'æ€ä¹¡',
    poetryId: '1'
  },
  {
    id: '7',
    content: 'é£æµç›´ä¸‹ä¸‰åƒå°ºï¼Œç–‘æ˜¯é“¶æ²³è½ä¹å¤©',
    poetryTitle: 'æœ›åºå±±ç€‘å¸ƒ',
    author: 'æç™½',
    dynasty: 'å”',
    theme: 'å±±æ°´',
    poetryId: '13'
  },
  {
    id: '8',
    content: 'ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±',
    poetryTitle: 'æ—©å‘ç™½å¸åŸ',
    author: 'æç™½',
    dynasty: 'å”',
    theme: 'å±±æ°´',
    poetryId: '14'
  },
  {
    id: '9',
    content: 'é»„å››å¨˜å®¶èŠ±æ»¡è¹Šï¼Œåƒæœµä¸‡æœµå‹æä½',
    poetryTitle: 'æ±Ÿç•”ç‹¬æ­¥å¯»èŠ±',
    author: 'æœç”«',
    dynasty: 'å”',
    theme: 'æ˜¥å¤©',
    poetryId: '12'
  },
  {
    id: '10',
    content: 'ä¸¤ä¸ªé»„é¹‚é¸£ç¿ æŸ³ï¼Œä¸€è¡Œç™½é¹­ä¸Šé’å¤©',
    poetryTitle: 'ç»å¥',
    author: 'æœç”«',
    dynasty: 'å”',
    theme: 'æ˜¥å¤©',
    poetryId: '12'
  },
  {
    id: '11',
    content: 'åŠå›æ›´å°½ä¸€æ¯é…’ï¼Œè¥¿å‡ºé˜³å…³æ— æ•…äºº',
    poetryTitle: 'é€å…ƒäºŒä½¿å®‰è¥¿',
    author: 'ç‹ç»´',
    dynasty: 'å”',
    theme: 'é€åˆ«',
    poetryId: '21'
  },
  {
    id: '12',
    content: 'ç‹¬åœ¨å¼‚ä¹¡ä¸ºå¼‚å®¢ï¼Œæ¯é€¢ä½³èŠ‚å€æ€äº²',
    poetryTitle: 'ä¹æœˆä¹æ—¥å¿†å±±ä¸œå…„å¼Ÿ',
    author: 'ç‹ç»´',
    dynasty: 'å”',
    theme: 'æ€ä¹¡',
    poetryId: '22'
  },
  {
    id: '13',
    content: 'å¤§æ¼ å­¤çƒŸç›´ï¼Œé•¿æ²³è½æ—¥åœ†',
    poetryTitle: 'ä½¿è‡³å¡ä¸Š',
    author: 'ç‹ç»´',
    dynasty: 'å”',
    theme: 'è¾¹å¡',
    poetryId: '11'
  },
  {
    id: '14',
    content: 'ç©ºå±±ä¸è§äººï¼Œä½†é—»äººè¯­å“',
    poetryTitle: 'é¹¿æŸ´',
    author: 'ç‹ç»´',
    dynasty: 'å”',
    theme: 'å±±æ°´',
    poetryId: '5'
  },
  {
    id: '15',
    content: 'é‡ç«çƒ§ä¸å°½ï¼Œæ˜¥é£å¹åˆç”Ÿ',
    poetryTitle: 'èµ‹å¾—å¤åŸè‰é€åˆ«',
    author: 'ç™½å±…æ˜“',
    dynasty: 'å”',
    theme: 'å“²ç†',
    poetryId: '9'
  },
  {
    id: '16',
    content: 'æ—¥å‡ºæ±ŸèŠ±çº¢èƒœç«ï¼Œæ˜¥æ¥æ±Ÿæ°´ç»¿å¦‚è“',
    poetryTitle: 'å¿†æ±Ÿå—',
    author: 'ç™½å±…æ˜“',
    dynasty: 'å”',
    theme: 'æ˜¥å¤©',
    poetryId: '25'
  },
  {
    id: '17',
    content: 'åŒæ˜¯å¤©æ¶¯æ²¦è½äººï¼Œç›¸é€¢ä½•å¿…æ›¾ç›¸è¯†',
    poetryTitle: 'çµç¶è¡Œ',
    author: 'ç™½å±…æ˜“',
    dynasty: 'å”',
    theme: 'å‹æƒ…',
    poetryId: '15'
  },
  {
    id: '18',
    content: 'å…ˆå¤©ä¸‹ä¹‹å¿§è€Œå¿§ï¼Œåå¤©ä¸‹ä¹‹ä¹è€Œä¹',
    poetryTitle: 'å²³é˜³æ¥¼è®°',
    author: 'èŒƒä»²æ·¹',
    dynasty: 'å®‹',
    theme: 'å“²ç†',
    poetryId: '16'
  },
  {
    id: '19',
    content: 'æ˜æœˆå‡ æ—¶æœ‰ï¼ŸæŠŠé…’é—®é’å¤©',
    poetryTitle: 'æ°´è°ƒæ­Œå¤´',
    author: 'è‹è½¼',
    dynasty: 'å®‹',
    theme: 'æœˆäº®',
    poetryId: '16'
  },
  {
    id: '20',
    content: 'ä½†æ„¿äººé•¿ä¹…ï¼Œåƒé‡Œå…±å©µå¨Ÿ',
    poetryTitle: 'æ°´è°ƒæ­Œå¤´',
    author: 'è‹è½¼',
    dynasty: 'å®‹',
    theme: 'ç¥ç¦',
    poetryId: '16'
  },
  {
    id: '21',
    content: 'å¤§æ±Ÿä¸œå»ï¼Œæµªæ·˜å°½ï¼Œåƒå¤é£æµäººç‰©',
    poetryTitle: 'å¿µå¥´å¨‡Â·èµ¤å£æ€€å¤',
    author: 'è‹è½¼',
    dynasty: 'å®‹',
    theme: 'å†å²',
    poetryId: '17'
  },
  {
    id: '22',
    content: 'æ¬²æŠŠè¥¿æ¹–æ¯”è¥¿å­ï¼Œæ·¡å¦†æµ“æŠ¹æ€»ç›¸å®œ',
    poetryTitle: 'é¥®æ¹–ä¸Šåˆæ™´åé›¨',
    author: 'è‹è½¼',
    dynasty: 'å®‹',
    theme: 'å±±æ°´',
    poetryId: '24'
  },
  {
    id: '23',
    content: 'äººç”Ÿè‡ªå¤è°æ— æ­»ï¼Œç•™å–ä¸¹å¿ƒç…§æ±—é’',
    poetryTitle: 'è¿‡é›¶ä¸æ´‹',
    author: 'æ–‡å¤©ç¥¥',
    dynasty: 'å®‹',
    theme: 'çˆ±å›½',
    poetryId: '20'
  },
  {
    id: '24',
    content: 'å±±é‡æ°´å¤ç–‘æ— è·¯ï¼ŒæŸ³æš—èŠ±æ˜åˆä¸€æ‘',
    poetryTitle: 'æ¸¸å±±è¥¿æ‘',
    author: 'é™†æ¸¸',
    dynasty: 'å®‹',
    theme: 'å“²ç†',
    poetryId: '19'
  },
  {
    id: '25',
    content: 'é›¶è½æˆæ³¥ç¢¾ä½œå°˜ï¼Œåªæœ‰é¦™å¦‚æ•…',
    poetryTitle: 'åœç®—å­Â·å’æ¢…',
    author: 'é™†æ¸¸',
    dynasty: 'å®‹',
    theme: 'åŠ±å¿—',
    poetryId: '19'
  },
  {
    id: '26',
    content: 'å¯»å¯»è§…è§…ï¼Œå†·å†·æ¸…æ¸…ï¼Œå‡„å‡„æƒ¨æƒ¨æˆšæˆš',
    poetryTitle: 'å£°å£°æ…¢',
    author: 'ææ¸…ç…§',
    dynasty: 'å®‹',
    theme: 'æ‚²ä¼¤',
    poetryId: '19'
  },
  {
    id: '27',
    content: 'è«ç­‰é—²ï¼Œç™½äº†å°‘å¹´å¤´ï¼Œç©ºæ‚²åˆ‡',
    poetryTitle: 'æ»¡æ±Ÿçº¢',
    author: 'å²³é£',
    dynasty: 'å®‹',
    theme: 'åŠ±å¿—',
    poetryId: '20'
  },
  {
    id: '28',
    content: 'äººç”Ÿä»£ä»£æ— ç©·å·²ï¼Œæ±Ÿæœˆå¹´å¹´åªç›¸ä¼¼',
    poetryTitle: 'æ˜¥æ±ŸèŠ±æœˆå¤œ',
    author: 'å¼ è‹¥è™š',
    dynasty: 'å”',
    theme: 'å“²ç†',
    poetryId: '26'
  },
  {
    id: '29',
    content: 'æ˜¥æ±Ÿæ½®æ°´è¿æµ·å¹³ï¼Œæµ·ä¸Šæ˜æœˆå…±æ½®ç”Ÿ',
    poetryTitle: 'æ˜¥æ±ŸèŠ±æœˆå¤œ',
    author: 'å¼ è‹¥è™š',
    dynasty: 'å”',
    theme: 'æœˆäº®',
    poetryId: '26'
  },
  {
    id: '30',
    content: 'æ­¤æ—¶ç›¸æœ›ä¸ç›¸é—»ï¼Œæ„¿é€æœˆåæµç…§å›',
    poetryTitle: 'æ˜¥æ±ŸèŠ±æœˆå¤œ',
    author: 'å¼ è‹¥è™š',
    dynasty: 'å”',
    theme: 'çˆ±æƒ…',
    poetryId: '26'
  }
];

const themes = [
  'å…¨éƒ¨',
  'å‹æƒ…',
  'å“²ç†',
  'é€åˆ«',
  'æ˜¥å¤©',
  'æ€ä¹¡',
  'å±±æ°´',
  'æœˆäº®',
  'çˆ±å›½',
  'åŠ±å¿—',
  'çˆ±æƒ…',
  'æ‚²ä¼¤',
  'å†å²',
  'ç¥ç¦',
  'è¾¹å¡'
];

const filteredLines = computed(() => {
  let lines = famousLines;
  
  if (selectedTheme.value && selectedTheme.value !== 'å…¨éƒ¨') {
    lines = lines.filter(line => line.theme === selectedTheme.value);
  }
  
  if (searchQuery.value.trim()) {
    const query = searchQuery.value.toLowerCase().trim();
    lines = lines.filter(line => 
      line.content.toLowerCase().includes(query) ||
      line.poetryTitle.toLowerCase().includes(query) ||
      line.author.toLowerCase().includes(query)
    );
  }
  
  return lines;
});

const goToPoetry = (poetryId: string) => {
  router.push(`/poetry/${poetryId}`);
};

const handleSearchSelect = (poetry: Poetry) => {
  router.push(`/poetry/${poetry.id}`);
};
</script>

<template>
  <div class="famous-lines">
    <div class="container">
      <header class="page-header">
        <h1 class="page-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
          </svg>
          åå¥é›†é”¦
        </h1>
        <p class="page-subtitle">å“å‘³åƒå¤åå¥ï¼Œæ„Ÿå—è¯—è¯é­…åŠ›</p>
      </header>

      <main class="page-content">
        <SearchBar
          placeholder="æœç´¢åå¥ã€è¯—è¯ã€ä½œè€…..."
          @select="handleSearchSelect"
        />

        <div class="theme-filter">
          <button
            v-for="theme in themes"
            :key="theme"
            class="theme-btn"
            :class="{ active: selectedTheme === theme || (theme === 'å…¨éƒ¨' && !selectedTheme) }"
            @click="selectedTheme = theme === 'å…¨éƒ¨' ? '' : theme"
          >
            {{ theme }}
          </button>
        </div>

        <div class="lines-grid">
          <div
            v-for="line in filteredLines"
            :key="line.id"
            class="line-card glass-effect"
            @click="goToPoetry(line.poetryId)"
          >
            <div class="line-content">
              <p class="line-text">"{{ line.content }}"</p>
            </div>
            <div class="line-meta">
              <span class="line-source">â€”â€” {{ line.poetryTitle }}</span>
              <span class="line-author">{{ line.author }} Â· {{ line.dynasty }}</span>
            </div>
            <span class="line-theme">{{ line.theme }}</span>
          </div>
        </div>

        <div v-if="filteredLines.length === 0" class="no-results">
          <div class="no-results-icon">ğŸ“</div>
          <h3>æ²¡æœ‰æ‰¾åˆ°ç›¸å…³åå¥</h3>
          <p>è¯•è¯•å…¶ä»–æœç´¢è¯æˆ–ä¸»é¢˜</p>
        </div>
      </main>

      <footer class="footer">
        <p>è¯—è¯ä¸­å›½ - åå¥é›†é”¦</p>
        <p>ä¼ æ‰¿ä¸­åæ–‡åŒ–ï¼Œå“å‘³è¯—è¯ä¹‹ç¾</p>
      </footer>
    </div>
  </div>
</template>

<style scoped>
.famous-lines {
  min-height: 100vh;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 2rem;
}

.page-header {
  text-align: center;
  padding: 3rem 2rem;
}

.page-title {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  font-size: 2.5rem;
  color: var(--primary-color);
  margin-bottom: 0.5rem;
}

.page-title svg {
  color: var(--accent-color);
}

.page-subtitle {
  font-size: 1.1rem;
  opacity: 0.7;
}

.page-content {
  padding-bottom: 4rem;
}

.theme-filter {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  margin: 2rem 0;
  justify-content: center;
}

.theme-btn {
  padding: 0.5rem 1rem;
  background: var(--card-bg-light);
  border: 1px solid var(--border-color-light);
  border-radius: 20px;
  color: var(--text-color);
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.theme-btn:hover {
  border-color: var(--primary-color);
  color: var(--primary-color);
}

.theme-btn.active {
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  color: white;
  border-color: transparent;
}

.lines-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
}

.line-card {
  padding: 1.5rem;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.line-card::before {
  content: '"';
  position: absolute;
  top: -10px;
  left: 10px;
  font-size: 6rem;
  color: var(--primary-color);
  opacity: 0.05;
  font-family: serif;
}

.line-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-dark);
}

.line-content {
  margin-bottom: 1rem;
}

.line-text {
  font-size: 1.2rem;
  line-height: 1.6;
  color: var(--text-color);
  font-family: 'Noto Serif TC', serif;
  margin: 0;
}

.line-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 1rem;
  border-top: 1px solid var(--border-color-light);
}

.line-source {
  font-size: 0.95rem;
  color: var(--primary-color);
  font-weight: 500;
}

.line-author {
  font-size: 0.85rem;
  opacity: 0.7;
}

.line-theme {
  position: absolute;
  top: 1rem;
  right: 1rem;
  padding: 0.25rem 0.75rem;
  background: rgba(219, 39, 119, 0.1);
  border-radius: 12px;
  font-size: 0.8rem;
  color: var(--primary-color);
}

.no-results {
  text-align: center;
  padding: 4rem 2rem;
}

.no-results-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}

.no-results h3 {
  color: var(--text-color);
  margin-bottom: 0.5rem;
}

.no-results p {
  opacity: 0.7;
}

.footer {
  text-align: center;
  padding: 3rem 2rem;
  border-top: 1px solid var(--border-color-light);
}

.footer p {
  margin: 0.5rem 0;
  opacity: 0.8;
}

@media (max-width: 768px) {
  .page-title {
    font-size: 2rem;
  }

  .lines-grid {
    grid-template-columns: 1fr;
  }

  .line-text {
    font-size: 1.1rem;
  }

  .theme-filter {
    gap: 0.5rem;
  }

  .theme-btn {
    padding: 0.4rem 0.75rem;
    font-size: 0.85rem;
  }
}
</style>